<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlcoCare - „ÅäÈÖí„Å®ÂÅ•Â∫∑„ÅÆË®òÈå≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #020617;
            color: #f8fafc;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 10px;
        }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.2.4",
        "react-dom": "https://esm.sh/react-dom@19.2.4",
        "react-dom/client": "https://esm.sh/react-dom@19.2.4/client",
        "lucide-react": "https://esm.sh/lucide-react@0.475.0",
        "recharts": "https://esm.sh/recharts@2.12.7",
        "@google/genai": "https://esm.sh/@google/genai@1.41.0"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            Plus, History, Activity, Settings, RefreshCw, AlertCircle, 
            Info, Camera, X, Check, User, Beer, Wine, GlassWater 
        } from 'lucide-react';
        import { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer 
        } from 'recharts';
        import { GoogleGenAI, Type } from '@google/genai';

        // --- Constants & Types ---
        const AICharacter = {
            DOCTOR: 'DOCTOR',
            MAMA: 'MAMA',
            BUTLER: 'BUTLER'
        };

        const Gender = {
            MALE: 'MALE',
            FEMALE: 'FEMALE'
        };

        const DRINK_PRESETS = [
            { name: '„Éì„Éº„É´ (350ml)', abv: 5, volume: 350 },
            { name: '„Éì„Éº„É´ (500ml)', abv: 5, volume: 500 },
            { name: '„Çπ„Éà„É≠„É≥„Ç∞Áº∂ (350ml)', abv: 9, volume: 350 },
            { name: '„Éè„Ç§„Éú„Éº„É´ („Ç∞„É©„Çπ)', abv: 7, volume: 200 },
            { name: '„É¨„É¢„É≥„Çµ„ÉØ„Éº („Ç∞„É©„Çπ)', abv: 5, volume: 200 },
            { name: 'Êó•Êú¨ÈÖí (1Âêà)', abv: 15, volume: 180 },
            { name: '„ÉØ„Ç§„É≥ („Ç∞„É©„Çπ)', abv: 12, volume: 125 },
            { name: 'ÁÑºÈÖé („Ç∞„É©„Çπ)', abv: 25, volume: 100 },
            { name: '„Ç¶„Ç§„Çπ„Ç≠„Éº („Ç∑„É≥„Ç∞„É´)', abv: 40, volume: 30 },
        ];

        const BAC_FACTORS = {
            MALE: 0.68,
            FEMALE: 0.55,
            METABOLISM_RATE: 0.015,
        };

        const CHARACTERS = {
            [AICharacter.DOCTOR]: {
                name: 'Âé≥Ê†º„Å™ÂåªËÄÖ',
                description: 'ÂåªÂ≠¶ÁöÑË¶ãÂú∞„Åã„ÇâÂé≥Ê†º„Å´„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åô',
                instruction: '„ÅÇ„Å™„Åü„ÅØËÇùËáìÂÜÖÁßëÂåª„Åß„Åô„ÄÇÂåªÂ≠¶ÁöÑË¶ãÂú∞„Åã„Çâ„Ç¢„É´„Ç≥„Éº„É´Èáè„ÇíÂé≥„Åó„Åè„ÉÅ„Çß„ÉÉ„ÇØ„Åó„ÄÅÈÅéÂâ∞ÊëÇÂèñ„Å´„ÅØË≠¶Âëä„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇË™ûÂ∞æ„ÅØ„Äå„Äú„Åß„Åô„Äç„Äå„Äú„Å™„Åï„ÅÑ„Äç„ÄÇ',
                icon: 'üë®‚Äç‚öïÔ∏è'
            },
            [AICharacter.MAMA]: {
                name: 'ÈäÄÂ∫ß„ÅÆ„Éû„Éû',
                description: '‰∏äÂìÅ„Å´Âä¥„ÅÑ„ÄÅÂØÑ„ÇäÊ∑ª„ÅÑ„Åæ„Åô',
                instruction: '„ÅÇ„Å™„Åü„ÅØÈäÄÂ∫ß„ÅÆÈ´òÁ¥ö„Éê„Éº„ÅÆ„Éû„Éû„Åß„Åô„ÄÇ‰∏äÂìÅ„Å´Âä¥„ÅÑ„Å™„Åå„Çâ„ÄÅ„ÅäÈÖí„ÅÆÁ®ÆÈ°û„ÇíË®òÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇË™ûÂ∞æ„ÅØ„Äå„Äú„Å≠„Äç„Äå„Äú„Å†„Çè„Äç„ÄÇ',
                icon: 'üë©‚Äçüíº'
            },
            [AICharacter.BUTLER]: {
                name: 'Âü∑‰∫ã',
                description: 'ÂÅ•Â∫∑„Å®Âá∫Ë≤ª„Çí‰∏ÅÂØß„Å´ÁÆ°ÁêÜ„Åó„Åæ„Åô',
                instruction: '„ÅÇ„Å™„Åü„ÅØÂø†ÂÆü„Å™Âü∑‰∫ã„Åß„Åô„ÄÇÊó¶ÈÇ£Êßò„ÅÆÂÅ•Â∫∑„Å®Âá∫Ë≤ª„ÇíÁÆ°ÁêÜ„Åó„Åæ„Åô„ÄÇ‰∏ÅÂØß„Å™Âè£Ë™ø„Åß„Ç¢„É´„Ç≥„Éº„É´Èáè„Å®Ê¶ÇÁÆóË≤ªÁî®„ÇíÂ†±Âëä„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                icon: 'ü§µ'
            }
        };

        // --- Utils ---
        const calculateAlcoholGrams = (drink) => {
            return drink.volume * (drink.abv / 100) * 0.8;
        };

        const calculateCurrentStats = (drinks, profile) => {
            const now = Date.now();
            const genderFactor = profile.gender === Gender.MALE ? BAC_FACTORS.MALE : BAC_FACTORS.FEMALE;
            let totalAlcoholGrams = 0;
            let bac = 0;
            let totalCalories = 0;

            drinks.forEach(drink => {
                const alcoholGrams = calculateAlcoholGrams(drink);
                totalAlcoholGrams += alcoholGrams;
                totalCalories += (alcoholGrams * 7) + (drink.volume * 0.1);
                const hoursSinceStart = (now - drink.timestamp) / (1000 * 60 * 60);
                const initialBAC = (alcoholGrams / (profile.weight * 1000 * genderFactor)) * 100;
                const currentBAC = Math.max(0, initialBAC - (BAC_FACTORS.METABOLISM_RATE * hoursSinceStart));
                bac += currentBAC;
            });

            let liverStress = 'Low';
            if (totalAlcoholGrams > 40) liverStress = 'High';
            else if (totalAlcoholGrams > 20) liverStress = 'Moderate';

            const soberInHours = bac / BAC_FACTORS.METABOLISM_RATE;

            return {
                bac: Number(bac.toFixed(3)),
                soberInHours: Number(soberInHours.toFixed(1)),
                totalAlcoholGrams: Math.round(totalAlcoholGrams),
                liverStress,
                calories: Math.round(totalCalories)
            };
        };

        // --- App Component ---
        const App = () => {
            const [profile, setProfile] = useState(() => {
                const saved = localStorage.getItem('alco_profile');
                return saved ? JSON.parse(saved) : { weight: 70, gender: Gender.MALE, character: AICharacter.DOCTOR };
            });
            const [drinks, setDrinks] = useState(() => {
                const saved = localStorage.getItem('alco_drinks');
                return saved ? JSON.parse(saved) : [];
            });
            const [aiResponse, setAiResponse] = useState("");
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [isPhotoAnalyzing, setIsPhotoAnalyzing] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [showLogModal, setShowLogModal] = useState(false);
            const [analysisError, setAnalysisError] = useState(null);
            const fileInputRef = useRef(null);

            useEffect(() => localStorage.setItem('alco_profile', JSON.stringify(profile)), [profile]);
            useEffect(() => localStorage.setItem('alco_drinks', JSON.stringify(drinks)), [drinks]);

            const stats = useMemo(() => calculateCurrentStats(drinks, profile), [drinks, profile]);

            const addDrink = (drinkData) => {
                const newDrink = {
                    id: Math.random().toString(36).substr(2, 9),
                    name: drinkData.name,
                    abv: drinkData.abv,
                    volume: drinkData.volume,
                    timestamp: Date.now()
                };
                setDrinks([newDrink, ...drinks]);
                setShowLogModal(false);
            };

            const clearHistory = () => {
                if (confirm('Ë®òÈå≤„Çí„Åô„Åπ„Å¶ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                    setDrinks([]);
                    setAiResponse("");
                }
            };

            const analyzePhoto = async (e) => {
                const file = e.target.files?.[0];
                if (!file) return;
                setIsPhotoAnalyzing(true);
                setAnalysisError(null);
                try {
                    const base64 = await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = () => resolve(reader.result.split(',')[1]);
                        reader.readAsDataURL(file);
                    });
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: [
                            { parts: [{ inlineData: { mimeType: file.type, data: base64 } }, { text: "„Åì„ÅÆ„ÅäÈÖí„ÅÆÂÜôÁúü„ÇíËß£Êûê„Åó„Å¶„ÄÅÁ®ÆÈ°ûÔºàÂêçÂâçÔºâ„ÄÅ„Ç¢„É´„Ç≥„Éº„É´Â∫¶Êï∞(ABV)„ÄÅÂÜÖÂÆπÈáè(ml)„ÇíÊé®ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÂõûÁ≠î„ÅØÂøÖ„Åö‰ª•‰∏ã„ÅÆJSONÂΩ¢Âºè„ÅÆ„Åø„ÅßËøî„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö {\"name\": \"„ÅäÈÖí„ÅÆÂêçÂâç\", \"abv\": 5.0, \"volume\": 350}" }] }
                        ],
                        config: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: Type.OBJECT,
                                properties: {
                                    name: { type: Type.STRING },
                                    abv: { type: Type.NUMBER },
                                    volume: { type: Type.NUMBER },
                                },
                                required: ["name", "abv", "volume"],
                            },
                        },
                    });
                    const result = JSON.parse(response.text);
                    if (result.name && result.abv && result.volume) addDrink(result);
                    else setAnalysisError("„ÅäÈÖí„ÇíÂà§Âà•„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ");
                } catch (error) {
                    console.error(error);
                    setAnalysisError("Ëß£Êûê„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ");
                } finally {
                    setIsPhotoAnalyzing(false);
                    if (fileInputRef.current) fileInputRef.current.value = '';
                }
            };

            const getAIAdvice = async () => {
                if (drinks.length === 0) return;
                setIsAiLoading(true);
                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const drinkSummary = drinks.slice(0, 5).map(d => `${d.name}(${d.abv}%, ${d.volume}ml)`).join(', ');
                    const charInfo = CHARACTERS[profile.character];
                    const prompt = `„É¶„Éº„Ç∂„Éº:${profile.gender},‰ΩìÈáç:${profile.weight}kg.È£≤ÈÖí:${drinkSummary}.BAC:${stats.bac}%.Ëß£ÊØí:${stats.soberInHours}h.‰∫∫Ê†º„Å´Âæì„Å£„Å¶„Ç¢„Éâ„Éê„Ç§„Çπ„Çí„ÄÇ`;
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: prompt,
                        config: { systemInstruction: charInfo.instruction },
                    });
                    setAiResponse(response.text || "ÂèñÂæóÂ§±Êïó");
                } catch (error) {
                    setAiResponse("AI„Ç®„É©„Éº");
                } finally { setIsAiLoading(false); }
            };

            const chartData = useMemo(() => {
                const days = {};
                drinks.slice(0, 20).forEach(d => {
                    const date = new Date(d.timestamp).toLocaleDateString('ja-JP', {month:'short', day:'numeric'});
                    days[date] = (days[date] || 0) + calculateAlcoholGrams(d);
                });
                return Object.entries(days).map(([name, amount]) => ({ name, amount })).reverse();
            }, [drinks]);

            const activeChar = CHARACTERS[profile.character];

            return (
                <div className="min-h-screen pb-24 max-w-2xl mx-auto px-4 pt-6 text-slate-200">
                    <header className="flex justify-between items-center mb-8">
                        <div>
                            <h1 className="text-2xl font-bold bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent">AlcoCare</h1>
                            <p className="text-slate-400 text-xs">ÂÅ•Â∫∑„Å™È£≤ÈÖí„Çí„Çµ„Éù„Éº„Éà</p>
                        </div>
                        <button onClick={() => setShowSettings(!showSettings)} className={`p-2 rounded-full transition ${showSettings ? 'bg-amber-500 text-white' : 'bg-slate-800 text-slate-300 hover:bg-slate-700'}`}>
                            <Settings size={20} />
                        </button>
                    </header>

                    {showSettings && (
                        <div className="mb-8 p-6 bg-slate-800/50 rounded-2xl border border-slate-700 animate-in fade-in slide-in-from-top-4 duration-300">
                            <h2 className="text-lg font-semibold mb-4 flex items-center gap-2"><Info size={18} /> Ë®≠ÂÆö</h2>
                            <div className="space-y-6">
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm text-slate-400 mb-2">ÊÄßÂà•</label>
                                        <div className="flex gap-2">
                                            {Object.entries(Gender).map(([k, v]) => (
                                                <button key={k} onClick={() => setProfile({...profile, gender: v})} className={`flex-1 py-2 rounded-lg border text-xs transition ${profile.gender === v ? 'bg-amber-500 border-amber-500 text-white' : 'border-slate-600 text-slate-400'}`}>{v === Gender.MALE ? 'Áî∑ÊÄß' : 'Â•≥ÊÄß'}</button>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm text-slate-400 mb-2">‰ΩìÈáç(kg)</label>
                                        <input type="number" value={profile.weight} onChange={(e) => setProfile({...profile, weight: Number(e.target.value)})} className="w-full bg-slate-900 border border-slate-600 rounded-lg py-2 px-4 text-white text-sm" />
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-sm text-slate-400 mb-2 flex items-center gap-1"><User size={14} /> AI„Ç≠„É£„É©„ÇØ„Çø„Éº</label>
                                    <div className="grid grid-cols-3 gap-2">
                                        {Object.entries(CHARACTERS).map(([k, char]) => (
                                            <button key={k} onClick={() => setProfile({...profile, character: k})} className={`p-3 rounded-xl border flex flex-col items-center gap-1 transition ${profile.character === k ? 'bg-amber-500/10 border-amber-500 text-amber-500 shadow-lg' : 'border-slate-700 bg-slate-900 text-slate-400'}`}>
                                                <span className="text-xl">{char.icon}</span>
                                                <span className="text-[10px] font-bold">{char.name}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <button onClick={clearHistory} className="w-full py-2 text-red-400 text-xs hover:bg-red-400/10 rounded-lg transition">Â±•Ê≠¥ÂâäÈô§</button>
                            </div>
                        </div>
                    )}

                    <section className="grid grid-cols-2 gap-4 mb-8">
                        <div className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-xl">
                            <p className="text-xs text-slate-400 mb-1 flex items-center gap-1"><Activity size={12} /> Êé®ÂÆöBAC</p>
                            <div className="flex items-baseline gap-1"><span className="text-3xl font-bold text-amber-400">{stats.bac}</span><span className="text-sm text-slate-400">%</span></div>
                            <div className="mt-2 w-full bg-slate-700 rounded-full h-1.5"><div className={`h-1.5 rounded-full transition-all duration-500 ${stats.bac > 0.15 ? 'bg-red-500' : stats.bac > 0.05 ? 'bg-orange-500' : 'bg-green-500'}`} style={{ width: `${Math.min(100, stats.bac * 400)}%` }} /></div>
                        </div>
                        <div className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-xl">
                            <p className="text-xs text-slate-400 mb-1 flex items-center gap-1"><RefreshCw size={12} /> ËÑ±ÈÖî„Åæ„Åß</p>
                            <div className="flex items-baseline gap-1"><span className="text-3xl font-bold text-blue-400">{stats.soberInHours}</span><span className="text-sm text-slate-400">ÊôÇÈñì</span></div>
                        </div>
                        <div className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-xl">
                            <p className="text-xs text-slate-400 mb-1">Á¥î„Ç¢„É´„Ç≥„Éº„É´Èáè</p>
                            <div className="flex items-baseline gap-1"><span className="text-2xl font-bold text-slate-200">{stats.totalAlcoholGrams}</span><span className="text-sm text-slate-400">g</span></div>
                        </div>
                        <div className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-xl">
                            <p className="text-xs text-slate-400 mb-1">Êé®ÂÆö„Ç´„É≠„É™„Éº</p>
                            <div className="flex items-baseline gap-1"><span className="text-2xl font-bold text-slate-200">{stats.calories}</span><span className="text-sm text-slate-400">kcal</span></div>
                        </div>
                    </section>

                    <section className="mb-8">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-lg font-bold flex items-center gap-2"><Activity className="text-amber-500" /> ÂÅ•Â∫∑„Ç¢„Éâ„Éê„Ç§„Çπ</h2>
                            <button disabled={isAiLoading || drinks.length === 0} onClick={getAIAdvice} className="text-xs bg-amber-500 hover:bg-amber-600 disabled:bg-slate-700 text-white px-3 py-1.5 rounded-full font-medium transition flex items-center gap-1 shadow-lg shadow-amber-900/20">
                                {isAiLoading ? <RefreshCw size={14} className="animate-spin" /> : 'AI„Å´Áõ∏Ë´á'}
                            </button>
                        </div>
                        <div className="bg-slate-900/80 rounded-2xl border border-slate-800 flex flex-col overflow-hidden shadow-2xl">
                            <div className="bg-slate-800/80 px-4 py-2 flex items-center gap-2 border-b border-slate-800/50">
                                <span className="text-lg">{activeChar.icon}</span><span className="text-xs font-bold text-amber-500">{activeChar.name}</span>
                            </div>
                            <div className="p-5 min-h-[100px] flex items-center justify-center relative">
                                {isAiLoading && <div className="absolute inset-0 bg-slate-900/40 backdrop-blur-sm z-10 flex items-center justify-center"><RefreshCw size={24} className="animate-spin text-amber-500" /></div>}
                                {aiResponse ? <div className="text-sm leading-relaxed text-slate-300 whitespace-pre-wrap w-full animate-in fade-in duration-500">{aiResponse}</div> : <p className="text-slate-500 text-sm text-center italic">„ÄåAI„Å´Áõ∏Ë´á„Äç„Éú„Çø„É≥„ÇíÊäº„Åô„Å®{activeChar.name}„Åã„ÇâÂä©Ë®Ä„ÅåÂ±ä„Åç„Åæ„Åô„ÄÇ</p>}
                            </div>
                        </div>
                    </section>

                    {drinks.length > 0 && (
                        <section className="mb-8">
                            <h2 className="text-lg font-bold mb-4 flex items-center gap-2"><History className="text-blue-500" /> È£≤ÈÖíË®òÈå≤ (Áõ¥Ëøë)</h2>
                            <div className="bg-slate-800 p-4 rounded-2xl border border-slate-700 h-48">
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={chartData}>
                                        <CartesianGrid strokeDasharray="3 3" stroke="#334155" vertical={false} />
                                        <XAxis dataKey="name" stroke="#94a3b8" fontSize={10} tickLine={false} axisLine={false} />
                                        <YAxis stroke="#94a3b8" fontSize={10} tickLine={false} axisLine={false} />
                                        <Tooltip contentStyle={{ backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', fontSize: '12px' }} itemStyle={{ color: '#fbbf24' }} />
                                        <Bar dataKey="amount" fill="#f59e0b" radius={[4, 4, 0, 0]} />
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </section>
                    )}

                    <section className="mb-8">
                        <h2 className="text-lg font-bold mb-4">ÊúÄËøë„ÅÆÈ£≤„ÅøÁâ©</h2>
                        <div className="space-y-3">
                            {drinks.length > 0 ? drinks.slice(0, 5).map((d) => (
                                <div key={d.id} className="bg-slate-800/40 p-4 rounded-xl border border-slate-800 flex justify-between items-center">
                                    <div><p className="text-sm font-medium text-slate-200">{d.name}</p><p className="text-[10px] text-slate-500">{new Date(d.timestamp).toLocaleString()}</p></div>
                                    <div className="text-right"><p className="text-xs text-amber-500 font-bold">{Math.round(calculateAlcoholGrams(d))}g Alc.</p><p className="text-[10px] text-slate-400">{d.abv}% | {d.volume}ml</p></div>
                                </div>
                            )) : <p className="text-slate-600 text-sm text-center py-8">„Éá„Éº„Çø„Å™„Åó</p>}
                        </div>
                    </section>

                    <div className="fixed bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-slate-950 via-slate-950/90 to-transparent z-40">
                        <div className="max-w-2xl mx-auto flex justify-center gap-4">
                            <button onClick={() => setShowLogModal(true)} className="flex-1 bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 rounded-full shadow-2xl flex items-center justify-center gap-2 transition active:scale-95"><Plus size={20} /> ËøΩÂä†</button>
                            <button onClick={() => fileInputRef.current?.click()} className="w-14 h-14 bg-slate-800 hover:bg-slate-700 text-amber-500 rounded-full shadow-2xl flex items-center justify-center transition active:scale-95 border border-slate-700">
                                <Camera size={24} />
                            </button>
                            <input type="file" ref={fileInputRef} onChange={analyzePhoto} accept="image/*" capture="environment" className="hidden" />
                        </div>
                    </div>

                    {showLogModal && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4">
                            <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={() => setShowLogModal(false)} />
                            <div className="relative bg-slate-900 w-full max-w-lg rounded-t-3xl sm:rounded-3xl border border-slate-700 p-6">
                                <h2 className="text-xl font-bold mb-6 text-center text-white">È£≤„ÅøÁâ©„ÇíËøΩÂä†</h2>
                                <div className="grid grid-cols-2 gap-3 mb-6 max-h-[40vh] overflow-y-auto pr-2 custom-scrollbar">
                                    {DRINK_PRESETS.map((p, i) => (
                                        <button key={i} onClick={() => addDrink(p)} className="bg-slate-800 hover:bg-slate-700 p-4 rounded-xl border border-slate-700 text-left transition active:scale-95">
                                            <p className="text-sm font-bold text-slate-200 mb-1">{p.name}</p>
                                            <p className="text-xs text-slate-400">{p.abv}% | {p.volume}ml</p>
                                        </button>
                                    ))}
                                </div>
                                <button onClick={() => setShowLogModal(false)} className="w-full py-3 bg-slate-800 text-slate-400 rounded-xl font-medium transition">Èñâ„Åò„Çã</button>
                            </div>
                        </div>
                    )}

                    {isPhotoAnalyzing && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-md">
                            <div className="text-center">
                                <div className="w-24 h-24 mx-auto mb-6 relative">
                                    <div className="absolute inset-0 rounded-full border-4 border-amber-500 border-t-transparent animate-spin"></div>
                                    <div className="absolute inset-0 flex items-center justify-center text-amber-500"><Camera size={32} /></div>
                                </div>
                                <h3 className="text-xl font-bold text-white mb-2">AIËß£Êûê‰∏≠...</h3>
                                <p className="text-slate-400 text-sm">ÂÜôÁúü„ÇíËß£Êûê„Åó„Å¶ÊÉÖÂ†±„ÇíÁâπÂÆö„Åó„Å¶„ÅÑ„Åæ„Åô</p>
                            </div>
                        </div>
                    )}

                    {analysisError && (
                        <div className="fixed top-6 left-4 right-4 z-[100] bg-red-500 text-white p-4 rounded-xl shadow-2xl flex items-center justify-between">
                            <div className="flex items-center gap-3"><AlertCircle size={20} /><p className="text-sm">{analysisError}</p></div>
                            <button onClick={() => setAnalysisError(null)}><X size={16} /></button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
